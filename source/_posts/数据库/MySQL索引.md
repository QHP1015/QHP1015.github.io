---
title: MySQL索引
author: 从此在回忆里
date: 2021-10-04 18:37:32
tags: 大学课程
categories: 数据库
---

### 索引

创建索引的目的是为了优化数据库的查询速度

所有MySQL列类型都可以被索引，对相关列使用索引是提高`SELECT`操作性能的**最佳途径**

索引的两种存储类型：**B型树索引**，**哈希索引**

<!-- more -->

索引的优点

- 通过创建唯一性索引，可以保证数据库数据的唯一性
- 大大加快数据的检索速度
- 加速表之间的连接
- 使用分组和排序子句进行数据检索时，可以显著减少查询时间
- 通过使用索引，在查询过程可以使用优化隐藏器，提高系统性能

索引的缺点

- 创建索引和维护索引耗时，随数据量增加而增加
- 索引占据一定的物理空间
- 对表中的数据进行增删改时，索引也要动态维护，降低了数据的维护速度

索引的特征：**唯一性索引**，**复合索引**

> 唯一性索引保证在索引列中的全部数据唯一，不包含冗余数据。
>
> 当表中有主键约束或唯一性键约束，当创建表或MySQL自动创建一个唯一性索引
>
> 当修改非空表中数据时，存在唯一性索引，表中存在冗余值，则修改操作失败

> 复合索引将一个索引创建在两个列或多列上
>
> 最多16个列合并为一个复合索引，列的总长度不超过900字节
>
> 复合索引的列必须来自同一个表
>
> 首先定义最唯一的列

索引的分类

- 普通索引：在创建普通索引时，不附加任何限制条件
- 唯一性索引：使用`UNIQUE`参数设置。通过唯一性索引，可以更快速地确定某条记录。**主键就是一种特殊唯一性索引**
- 全文索引：使用`FULLTEXT`参数设置。只能创建在`CHAR`、`VARCHAR`、`TEXT`类型字段。查询数据量较大地字符串类型字段使用
- 单列索引：在表中地**单个字段**上创建一个索引。单列索引只根据该字段进行索引，可以是以上三种索引
- 多列索引：在表中地**多个字段**上创建一个索引。查询条件只有带有第一个字段，索引才会被使用
- 空间索引：使用`SPATIAL`参数设置。只能创建在`GEMETRY`、`POINT`、`LINESTRING`、`POLYGON`这些空间类型上，值不能为`NULL`

### 索引的定义和管理

#### 创建索引

直接创建：

- 创建表时创建索引

  ```sql
  CREATE TABLE table_name(
  	属性名，数据类型[完整性约束]，
  	属性名，数据类型[完整性约束]，
  	……
  	INDEX | KEY [索引名](属性名[(长度)] [ASC|DESC])
  
  )
  ```

- 在已存在的表上创建索引

  ```sql
  CREATE INDEX 索引名 ON 表名 (属性名 [ (长度) ] [ASC|DESC])
  ```

- 使用`ALTER TABLE`语句创建索引

  ```sql
  ALTER TABLE table_name ADD INDEX | KEY [索引名](属性名[(长度)] [ASC|DESC])
  ```

间接创建：

​	表中定义主键约束或唯一性键约束时，同时创建索引

​	若表中已有使用`CREATE INDEX`创建的标准索引时，由主键约束或唯一性键约束创建的索引会覆盖之前的标准索引

##### 普通索引

```sql
EXPLAIN SELECT *FROM 表名 WHERE 字段='字段值'        --查看索引是否被使用，查看使用哪个索引
--使用ALTER TABLE在字段1的前五个记录上创建降序排序
ALTER TABLE 表名 ADD INDEX 索引名 (字段1(5) DESC)
--指定使用索引1用于字段查询
SELECT *FROM 表名 USE INDEX FOR JOIN(索引1) WHERE 字段='查询值'
```

##### 唯一索引

```sql
--使用CREATE INDEX 命令在表1的字段1上创建唯一性索引
CREATE UNIQUE INDEX 索引名 ON 表1(字段1)
--使用ALTER TABLE 命令在表1的字段1上创建唯一性索引
ALTER TABLE 表1 ADD UNIQUE INDEX (字段1)
```

##### 全文索引

```sql
--例：创建表1，并指定char(20)字段类型的字段1为全文索引
CREATE TABLE 表1(
	属性名，数据类型[完整性约束]，
	……
	字段1 CHAR(20),
	FULLTEXT INDEX 索引名(字段1)

);
```

##### 多列索引

```sql
--例：创建表1，并指定char(20)字段类型的字段1和int类型的字段2上创建多列索引
CREATE TABLE 表1(
	属性名，数据类型[完整性约束]，
	……
	字段1 CHAR(20),
	字段2 INT ，
	INDEX 索引名(字段1，字段2);
```

#### 查看索引

```sql
SHOW INDEX | KEY FROM table_name [FROM db_name]
```

`SHOW INDEX` 返回信息：

| 参数         | 说明                                                         |
| ------------ | ------------------------------------------------------------ |
| Table        | 表示创建索引的数据表名。                                     |
| Non_unique   | 表示该索引是否是唯一索引。若不是唯一索引，则该列的值为 1；若是唯一索引，则该列的值为 0。 |
| Key_name     | 表示索引的名称。                                             |
| Seq_in_index | 表示该列在索引中的位置，如果索引是单列的，则该列的值为 1；如果索引是组合索引，则该列的值为每列在索引定义中的顺序。 |
| Column_name  | 表示定义索引的列字段。                                       |
| Collation    | 表示列以何种顺序存储在索引中。在 MySQL 中，升序显示值“A”（升序），若显示为 NULL，则表示无分类。 |
| Cardinality  | 索引中唯一值数目的估计值。基数根据被存储为整数的统计数据计数，所以即使对于小型表，该值也没有必要是精确的。基数越大，当进行联合时，MySQL 使用该索引的机会就越大。 |
| Sub_part     | 表示列中被编入索引的字符的数量。若列只是部分被编入索引，则该列的值为被编入索引的字符的数目；若整列被编入索引，则该列的值为 NULL。 |
| Packed       | 指示关键字如何被压缩。若没有被压缩，值为 NULL。              |
| Null         | 用于显示索引列中是否包含 NULL。若列含有 NULL，该列的值为 YES。若没有，则该列的值为 NO。 |
| Index_type   | 显示索引使用过的类型和方法（BTREE、FULLTEXT、HASH、RTREE）。 |
| Comment      | 显示评注。                                                   |

#### 删除索引

```sql
ALTER TABLE table_name DROP INDEX index_name
ALTER TABLE table_name DROP PRIMARY KEY
DROP INDEX index_name ON table_name
```

第二条语句只删除`PRIMARY KEY`索引，一个表只可能有一个`PRIMARY KEY`索引，因此不需要指定索引名

多列索引，删除其中的某列，则该列也会从索引中删除，组成索引的所有列都被删除，则整个索引被删除

### 设计原则和注意事项

#### 索引的设计原则

- 选择唯一性索引
- 为经常需要排序、分组和联合操作的字段建立索引
- 为常作为查询条件的字段建立索引
- 限制索引的数目
- 尽量使用数据量少的索引
- 尽量使用前缀来索引
- 删除不在使用或很少使用的索引

#### 合理使用索引的注意事项

一般**在**以下列上创建索引

- 在经常需要搜索的列上，可以加快搜索速度
- 在作为主键的列上，强制该列的唯一性和组织表中数据的排列结构
- 在经常用在连接的列上，这些列主要是一些外键，可以加快连接的速度
- 在经常需要根据范围进行搜索的列上创建索引，因为索引已经排序，指定范围时连续的
- 在经常需要排序的列上创建索引，因为索引已经排序，这样查询可以利用索引的排序，加快排序查询时间
- 经常使用在`WHERE`子句中的列上创建索引，加快条件的判断条件

#### 不合理使用索引的注意事项

一般**不在**以下列上创建索引

- 对于在查询中很少使用或者参考的列不应该创建索引
- 对于只有很少数据值的列也不应该增加索引
- 对于定义为`text`、`image`和`bit`数据类型的列不应该增加索引
- 当修改性能远远大于检索性能时，不应该创建索引
