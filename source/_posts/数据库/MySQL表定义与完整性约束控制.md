---
title: MySQL表定义与完整性约束控制
author: 从此在回忆里
date: 2021-10-04 16:41:39
tags: 大学课程
categories: 数据库
---

### 表

数据库由各种数据表组成，数据表是用来存储和操作数据的逻辑结构

- 每个表应该只包含关于一个主题的信息
- 表中不应包含重复信息

<!--more-->

### 数据类型

##### 数值数据类型：

- 整数类型：`TINYINT`、`SMALLINT`、`MEDIUMINT`、`INT`、`BIGINT`

  | **MySQL数据类型** | **含义（有符号）**                                          |
  | ----------------- | ----------------------------------------------------------- |
  | TINYINT(m)        | 1个字节 范围(-128~127)                         小整数值     |
  | SMALLINT(m)       | 2个字节 范围(-32768~32767)                大整数值          |
  | MEDIUMINT(m)      | 3个字节 范围(-8388608~8388607)       大整数值               |
  | INT(m)            | 4个字节 范围(-2147483648~2147483647)               大整数值 |
  | BIGINT(m)         | 8个字节 范围(+-9.22*10的18次方)          极大整数值         |

- 浮点数类型：`FLOAT`、`DOUBLE`

  | **MySQL数据类型** | **含义**                                      |
  | ----------------- | --------------------------------------------- |
  | FLOAT(m,d)        | 单精度浮点型 8位精度(4字节) m总个数，d小数位  |
  | DOUBLE(m,d)       | 双精度浮点型 16位精度(8字节) m总个数，d小数位 |

- 定点小数类型：`DECIMAL`

  浮点型在数据库中存放的是近似值，而定点类型在数据库中存放的是精确值。

  | **MySQL数据类型** | **含义**                                 |
  | ----------------- | ---------------------------------------- |
  | DECIMAL(m,d)      | 参数m<65 是总个数，d<30且 d<m 是小数位。 |



##### 日期/时间类型：

- `YEAR`、`TIME`、`DATE`、`DATETIME`、`TIMESTAMP`

  | **MySQL数据类型** | **含义**                      |
  | ----------------- | :---------------------------- |
  | DATE              | 日期 '2008-12-2'              |
  | TIME              | 时间 '12:25:36'               |
  | DATETIME          | 日期时间 '2008-12-2 22:06:44' |
  | TIMESTAMP         | 自动存储记录修改时间          |
  | YEAR              | 年份值                        |



##### 字符串类型：

- `CHAR`、`VARCHAR`、`BINARY`、`VARBINARY`、`BLOB`、`TEXT`、`ENUM`、`SET`

  | **MySQL数据类型** | 大小                | 用途             |
  | ----------------- | ------------------- | ---------------- |
  | CHAR              | 0-255字节           | 定长字符串       |
  | VARCHAR           | 0-255字节           | 变长字符串       |
  | TINYTEXT          | 0-255字节           | 短文本字符串     |
  | TEXT              | 0-65 535字节        | 长文本数据       |
  | MEDIUMTEXT        | 0-16 777 215字节    | 中等长度文本数据 |
  | LONGTEXT          | 0-4 294 967 295字节 | 极大文本数据     |



##### 二进制类型：

- `BIT`、`BINARY`、`VARBINARY`、`TINYBLOB`、`BLOB`、`MEDIUMBLOB`、`LONGBLOB`

  | **MySQL数据类型** | 大小                | 用途                            |
  | ----------------- | ------------------- | ------------------------------- |
  | TINYBLOB          | 0-255字节           | 不超过 255 个字符的二进制字符串 |
  | BLOB              | 0-65 535字节        | 二进制形式的长文本数据          |
  | MEDIUMBLOB        | 0-16 777 215字节    | 二进制形式的中等长度文本数据    |
  | LOGNGBLOB         | 0-4 294 967 295字节 | 二进制形式的极大文本数据        |



##### 选择：

- 在符合应用要求（取值范围、精度）的前提下，尽量使用“短”数据类型
- 数据类型越简单越好
- 尽量采用精确小数类型，而不采用浮点数类型
- 使用内置的日期和时间数据类型，而不是使用字符串来存储
- 尽量避免`NULL`字段，建议将字段指定为`NOT NULL` 约束





### 运算符

##### 算术运算符：

| 算术运算符 | 说明               |
| ---------- | ------------------ |
| +          | 加法运算           |
| -          | 减法运算           |
| *          | 乘法运算           |
| /          | 除法运算，返回商   |
| %          | 求余运算，返回余数 |



##### 比较运算符：

| 比较运算符        | 说明                               |
| ----------------- | ---------------------------------- |
| =                 | 等于                               |
| <                 | 小于                               |
| <=                | 小于等于                           |
| >                 | 大于                               |
| >=                | 大于等于                           |
| <=>               | 安全的等于，不会返回 UNKNOWN       |
| <> 或!=           | 不等于                             |
| IS NULL 或 ISNULL | 判断一个值是否为 NULL              |
| IS NOT NULL       | 判断一个值是否不为 NULL            |
| LEAST             | 当有两个或多个参数时，返回最小值   |
| GREATEST          | 当有两个或多个参数时，返回最大值   |
| BETWEEN AND       | 判断一个值是否落在两个值之间       |
| IN                | 判断一个值是IN列表中的任意一个值   |
| NOT IN            | 判断一个值不是IN列表中的任意一个值 |
| LIKE              | 通配符匹配                         |
| REGEXP            | 正则表达式匹配                     |

###### 正则匹配：

- ’ ^ ’  匹配以该字符后面的字符开头的字符串
- ‘ $ ’  匹配以该字符前面的字符结尾的字符串
- ‘ . '   匹配任何一个单字符
- “ [ … ] ”  匹配在方括号内的任何字符        如” [ abc ] “ 表示匹配a、b或c        范围可用’ - ‘ 表示        如“ [ a-z ] "  表示匹配任意字母
- ’ * ’  匹配零个或多个在其前面的字符       如” x* “ 表示匹配任意数量的” x ” 字符



##### 逻辑运算符

| 逻辑运算符   | 说明                           |
| ------------ | ------------------------------ |
| NOT 或者 !   | 逻辑非                         |
| AND 或者 &&  | 逻辑与                         |
| OR 或者 \|\| | 逻辑或                         |
| XOR          | 逻辑异或（相同为零，相异为一） |



##### 位运算符：

| 位运算符 | 说明                   |
| -------- | ---------------------- |
| \|       | 按位或                 |
| &        | 按位与                 |
| ^        | 按位异或               |
| <<       | 按位左移               |
| >>       | 按位右移               |
| ~        | 按位取反，反转所有比特 |





### 数据表操作

#### 创建

```sql
USE<数据库名>											--使用数据库
CREATE TABLE [IF NOT EXISTS] table_name(			   --创建表
	属性名 属性值
	id int(4) NOT NULL UNIQUE COMMENT '编号'，
)
```



#### 查看

```sql
SHOW  TABLES					--查看数据库所有表名

--查看表的结构
DESCRIBE 表名
DESC  表名	
SHOW CREATE TABLE 表名           --不仅可以查看表创建时的详细语句，还可以查看存储引擎和字符编码
```



#### 修改

```sql
--修改表名
ALTER TABLE<旧表名> RENAME [TO] <新表名>
--修改字段数据类型
ALTER TABLE<表名> MODIFY <字段名> <数据类型>
--修改字段名
ALTER TABLE<表名> CHANGE <旧字段名> <新字段名> <新数据类型>
--添加数据表字段
ALTER TABLE<表名> ADD <新字段名> <数据类型> [约束条件] [FIRST|AFTER 已经存在的字段名]
--删除字段
ALTER TABLE<表名> DROP <字段名>
--修改字段排序
ALTER TABLE<表名> MODIFY <字段1> <数据类型> FIRST|AFTER <字段2>
--更改表的存储引擎
ALTER TABLE<表名> ENGINE =<更改后的存储引擎名>
--删除表的外键约束
ALTER TABLE<表名> DROP FOREIGN KEY <外键约束名>
```



#### 复制

```sql
--复制表的结构和数据
CREATE TABLE [IF NOT EXISTS] table_name
[ () LIKE old_table_name[] ]							--选择表
| [AS (select_statement)]                               --选择字段
```



#### 删除

```sql
DROP TABLE[IF EXISTS] 表1，表2……						  --删除表
SHOW TABLES 											--查看全部表
```





### 约束控制

#### 数据完整性约束

- 实体完整性：强制表的标识符列或主键的完整性
- 参照完整性：在删除和输入记录是，引用完整性保持表之间已定义的关系，确保键值在所有表中一致（不能引用不存在的值）
- 域完整性：限制类型、格式、可能值范围（外键约束、检查约束、默认值约束、非空约束和规则）
- 用户自定义完整性：用户自己定义的业务规则



#### 字段约束

##### 主键约束：

主键分为：单字段主键和多字段联合主键

任何主键字段的值不允许为`NULL`

```sql
PRIMARY KEY(字段名) 							--设置单字段主键
PRIMARY KEY(字段名1，字段名2)					 --设置多字段联合主键
ALTER TABLE 表名 DROP PRIMARY KEY , ADD PRIMARY KEY(字段名)			--修改主键（先删除原来的主键，增加新主键）
```



##### 外键约束：

外键取值 `NULL` 或者为关联表对应字段的值

主表（父表）与从表（子表）之间，以关联值为关键字，建立相关表的联系

子表的记录“参照”父表的记录，则父表的该记录不能删除（`DELETE`）或修改（`UPDATE`）

插入（`INSERT`）或者修改（`UPDATE`）子表的“外键值”，子表的“外键值”必须为父表的“主键值”或 `NULL`

```sql
--表级完整性
FOREIGN KEY(表A的字段名列表) REFERENCES 表B(字段名列表)        
[ ON DELETE { CASCADE|RESTRICT|SET NULL|NO ACTION } ]
[ ON UPDATE { CASCADE|RESTRICT|SET NULL|NO ACTION } ]

/*
CASCADE：父表记录的删除或修改会自动删除或修改子表中对应的记录
RESTRICT:与NO ACTION 功能相同，为级联默认选项
SET NULL:父表记录的删除或修改会将子表中对应的外键值设置为NULL
NO ACTION:父表执行记录的删除或修改时，若子表存在对应记录，操作失败
*/
	--若表已创建
	ALTER TABLE table_name   
	ADD [CONSTRAINT 外键名] FOREIGN KEY [id] (index_col_name,……)
	REFERENCES table_name(index_col_name,……)
	[ ON DELETE { CASCADE|RESTRICT|SET NULL|NO ACTION } ]
	[ ON UPDATE { CASCADE|RESTRICT|SET NULL|NO ACTION } ]
	--若表未创建
	CREATE TABLE 表名(
	index_col_name  数据类型  约束,
	……,
	FOREIGN KEY(index_col_name) REFERENCES 表名(index_col_name)
	)
--列级完整性
CREATE TABLE 表名(
	index_col_name  数据类型 约束 REFERENCES 表名(index_col_name),     --直接在字段后添加REFERENCES命令
	……,
```



##### 非空约束：

设置某个字段的非空约束，即该字段不能为`NULL`

```sql
字段名 数据类型 NOT NULL
```



##### 唯一约束：

要求该列唯一，允许为空，但只能出现一个空值

```sql
字段名 数据类型 UNIQUE 
```

`UNIQUE` 和`PRIMARY KEY` 的区别：一个表中可以有多个字段声明为`UNIQUE`且允许空值，只能有一个`PRIMARY KEY` 声明且不允许空值



##### 默认约束：

若某字段满足默认值约束要求，可以向该字段添加默认值约束

```sql
字段名 数据类型 [其他约束条件] DEFAULT 默认值
```



##### 自增约束：

希望在每次插入新记录时，系统自动生成字段的主键值

一个表中只能有一个字段使用`AUTO_INCREMENT`约束，且该字段必须为主键的一部分

```sql
字段名 数据类型 [其他约束条件] AUTO_INCREMENT
```



##### 检查约束：

设置检查约束直接在数据类型后加约束

```sql
字段名 数据类型 [其他约束条件] CHECK(检查条件)
```



#### 删除约束

```sql
ALTER TABLE 表名 DROP 约束条件  字段名 
```

